# Architecture

> Auto-generated by /map on 2026-02-20

## Overview

A Next.js 14 web application providing astrological services and PDF report generation. The application serves as a frontend interface and specific API endpoints that orchestrate data fetching from a backend service to generate detailed PDF reports (horoscopes, matchmaking, etc.).

```
┌─────────────────────────────────────────┐
│        [Next.js App (Frontend)]         │
│  - app/(main): UI Pages                 │
│  - app/api: BFF / PDF Generation        │
├─────────────────────────────────────────┤
│           [Business Logic]              │
│  - lib/horoscopeApi.ts (Data Fetching)  │
│  - lib/pdf-pages-*.ts (PDF Rendering)   │
├─────────────────────────────────────────┤
│             [Data Layer]                │
│  - External Backend (via HTTP)          │
│  - Local PDF Debug Log (debug/read.txt) │
└─────────────────────────────────────────┘
```

## Components

### Frontend Pages

- **Purpose:** Serve the user interface for astrological tools (Daily Horoscope, Match Making, etc.).
- **Location:** `app/(main)/**/*`
- **Dependencies:** React, Tailwind CSS, Lucide Icons, Iconify.

### API Routes (PDF Generation)

- **Purpose:** fetching data, processing it, and generating PDF reports.
- **Location:** `app/api/**/*`
- **Key Examples:**
  - `app/api/western-natal-horoscope-pdf`: Generates Western Natal Charts.
  - `app/api/professional-horoscope-pdf`: Generates Professional Horoscopes.
- **Dependencies:** `jspdf`, `jspdf-autotable`, `lib/horoscopeApi.ts`.

### Data Fetching Layer

- **Purpose:** Centralized logic to fetch data from the external backend.
- **Location:** `lib/horoscopeApi.ts`
- **Dependencies:** `fetch` API, `process.env.BACKEND_URL`.

### PDF Logger

- **Purpose:** Log PDF generation steps to a local file for debugging.
- **Location:** `utils/pdfLogger.ts`
- **Note:** Writes to local filesystem (`debug/read.txt`), which may not persist in serverless environments.

## Data Flow

1. **User Request:** User submits birth details via a form on the frontend.
2. **API Call:** Frontend calls Next.js API route (e.g., `/api/western-natal-horoscope-pdf`).
3. **Backend Fetch:** API route calls `lib/horoscopeApi.ts`, which fetches data from the external `BACKEND_URL`.
4. **PDF Generation:** API route uses fetched data to render a PDF using `jspdf`.
5. **Response:** PDF is returned as a binary stream to the user.

## Integration Points

| Service          | Type        | Purpose                                      |
| ---------------- | ----------- | -------------------------------------------- |
| External Backend | HTTP API    | Source of astrological calculations and data |
| `debug/read.txt` | File System | Local logging for PDF debug traces           |

## Technical Debt

- [ ] **Type Safety:** Extensive use of `any` in `lib/horoscopeApi.ts` and `route.ts`.
- [ ] **Logging:** `utils/pdfLogger.ts` writes to local disk; inappropriate for serverless deployments (Vercel).
- [ ] **Cleanup:** `lib/horoscopeApi.ts` contains "❌ REMOVED" comments and commented-out code.
- [ ] **Error Handling:** Some API routes return 500s with generic messages; could be more specific.

## Conventions

**Naming:** camelCase for functions (`fetchAllHoroscopeData`), PascalCase for components.
**Structure:** Next.js App Router (`app/`) with grouped routes.
**Testing:** No automated tests detected in `__tests__` or `tests/`.
